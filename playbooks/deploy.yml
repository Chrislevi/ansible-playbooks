---
- hosts: deploy
  tasks:
  - setup:

- import_playbook: pubkey.yml

- hosts: deploy
  gather_facts: yes
  become: yes
  tasks:
  - include_role:
      name: archive_binary
    when: internet_available | bool

- hosts: all
  gather_facts: yes
  become: yes
  roles:
    - { role: common }

- hosts: registry
  gather_facts: yes
  roles:
    - { role: registry, purge: false}

- hosts: swarm-cluster
  become: yes
  gather_facts: yes
  roles:
    - { role: docker-swarm }

- hosts: swarm-managers[0]
  become: true
  gather_facts: yes
  roles:
    - { role: consul, purge: false }

- hosts: swarm-managers[0]
  become:
  gather_facts: yes
  roles:
    - { role: jenkins, purge: false }

- hosts: swarm-managers[0]
  become:
  gather_facts: yes
  roles:
    - { role: docker-pypi, purge: false }
